<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Socket.IO Test Client</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        .section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
        }
        button:hover {
            background-color: #45a049;
        }
        #log {
            background-color: #f4f4f4;
            padding: 15px;
            border-radius: 5px;
            max-height: 400px;
            overflow-y: auto;
            font-family: monospace;
            white-space: pre-wrap;
        }
        input {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            box-sizing: border-box;
        }
        .connected {
            color: green;
            font-weight: bold;
        }
        .disconnected {
            color: red;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>Socket.IO Test Client for FactRay</h1>

    <div class="section">
        <h2>ì—°ê²° ìƒíƒœ: <span id="status" class="disconnected">ì—°ê²° ì•ˆë¨</span></h2>
        <button onclick="connect()">ì—°ê²°</button>
        <button onclick="disconnect()">ì—°ê²° í•´ì œ</button>
    </div>

    <div class="section">
        <h2>ë¶„ì„ ìš”ì²­</h2>
        <label>YouTube URL:</label>
        <input type="text" id="videoUrl" value="https://www.youtube.com/shorts/dQw4w9WgXcQ" />
        <br><br>
        <button onclick="requestAnalysis()">ë¶„ì„ ì‹œì‘ (API í˜¸ì¶œ)</button>
    </div>

    <div class="section">
        <h2>ì´ë²¤íŠ¸ ë¡œê·¸</h2>
        <button onclick="clearLog()">ë¡œê·¸ ì§€ìš°ê¸°</button>
        <div id="log"></div>
    </div>

    <script>
        let socket = null;

        function log(message) {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.textContent += `[${timestamp}] ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function clearLog() {
            document.getElementById('log').textContent = '';
        }

        function updateStatus(connected) {
            const statusSpan = document.getElementById('status');
            if (connected) {
                statusSpan.textContent = 'ì—°ê²°ë¨';
                statusSpan.className = 'connected';
            } else {
                statusSpan.textContent = 'ì—°ê²° ì•ˆë¨';
                statusSpan.className = 'disconnected';
            }
        }

        function connect() {
            if (socket && socket.connected) {
                log('ì´ë¯¸ ì—°ê²°ë˜ì–´ ìˆìŠµë‹ˆë‹¤.');
                return;
            }

            log('Socket.IO ì„œë²„ì— ì—°ê²° ì¤‘...');
            socket = io('http://localhost:8000', {
                transports: ['websocket', 'polling']
            });

            socket.on('connect', () => {
                log('âœ… ì„œë²„ì— ì—°ê²°ë˜ì—ˆìŠµë‹ˆë‹¤!');
                updateStatus(true);
            });

            socket.on('disconnect', () => {
                log('âŒ ì„œë²„ì™€ì˜ ì—°ê²°ì´ ëŠì–´ì¡ŒìŠµë‹ˆë‹¤.');
                updateStatus(false);
            });

            socket.on('info', (data) => {
                log('ğŸ“º [INFO] ìˆ˜ì‹ :');
                log(JSON.stringify(data, null, 2));
            });

            socket.on('transcription', (data) => {
                log('ğŸ“ [TRANSCRIPTION] ìˆ˜ì‹ :');
                log(JSON.stringify(data, null, 2));
            });

            socket.on('extract', (data) => {
                log('ğŸ” [EXTRACT] ìˆ˜ì‹ :');
                log(JSON.stringify(data, null, 2));
            });

            socket.on('conclusion', (data) => {
                log('âœ… [CONCLUSION] ìˆ˜ì‹ :');
                log(JSON.stringify(data, null, 2));
            });

            socket.on('error', (error) => {
                log('âš ï¸ ì—ëŸ¬: ' + error);
            });
        }

        function disconnect() {
            if (socket) {
                socket.disconnect();
                socket = null;
                log('ì—°ê²°ì„ í•´ì œí–ˆìŠµë‹ˆë‹¤.');
                updateStatus(false);
            }
        }

        async function requestAnalysis() {
            const videoUrl = document.getElementById('videoUrl').value;

            if (!videoUrl) {
                alert('YouTube URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            log(`ğŸš€ ë¶„ì„ ìš”ì²­ ì‹œì‘: ${videoUrl}`);

            try {
                const response = await fetch(
                    `http://localhost:8000/api/analysis?videoURL=${encodeURIComponent(videoUrl)}`
                );

                const result = await response.json();

                if (response.ok) {
                    log('âœ… ë¶„ì„ ìš”ì²­ ì„±ê³µ:');
                    log(JSON.stringify(result, null, 2));
                } else {
                    log('âŒ ë¶„ì„ ìš”ì²­ ì‹¤íŒ¨:');
                    log(JSON.stringify(result, null, 2));
                }
            } catch (error) {
                log('âš ï¸ API í˜¸ì¶œ ì—ëŸ¬: ' + error.message);
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì—°ê²°
        window.addEventListener('load', () => {
            log('í˜ì´ì§€ê°€ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.');
            log('Socket.IO ì„œë²„: http://localhost:8000');
            log('API ì—”ë“œí¬ì¸íŠ¸: GET /api/analysis?videoURL=...');
            log('');
            log('ìˆ˜ì‹  ì´ë²¤íŠ¸:');
            log('  - info: ì˜ìƒ ì •ë³´ (title, thumbnail)');
            log('  - transcription: ì „ì‚¬ ìŠ¤í¬ë¦½íŠ¸');
            log('  - extract: ë…¼ì¦ ê·¸ë˜í”„');
            log('  - conclusion: ë¶„ì„ ê²°ë¡ ');
            log('');
            log('ì—°ê²° ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ Socket.IO ì„œë²„ì— ì—°ê²°í•˜ì„¸ìš”.');
        });
    </script>
</body>
</html>
